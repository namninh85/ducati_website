'use strict';var _createClass=function(){function defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FURIGANA_INPUT_ATTRIBUTE_KEY='data-furigana-type',KANJI_INPUT_TYPE='kanji',KANA_INPUT_TYPE='kana',ROMAJI_INPUT_TYPE='romaji',SPACE_KEY_CODE=32,WIDE_SPACE='\u3000',HIRAGANA_KATAKANA_OFFSET=96,HIRAGANA_INPUT_REGEX=new RegExp(/[ぁ-ん]/g),VALID_KANA_INPUT_REGEX=new RegExp(/[\u30A1-\u30F3\u30FC]/g),INVALID_KANA_INPUT_REGEX=new RegExp(/[^\u30A1-\u30F3\u30FC]/);function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return call&&('object'==typeof call||'function'==typeof call)?call:self}function _inherits(subClass,superClass){if('function'!=typeof superClass&&null!==superClass)throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}function style(a){return{field_pair:'jpnlp-a',label:'jpnlp-b',input:'jpnlp-c'}[a]}function injectStyles(){var a=null!==document.querySelector('style[data-css-id="jpn-language-pack"]');if(!a){var _d=document.createElement('style');_d.type='text/css',_d.setAttribute('data-css-id','jpn-language-pack'),_d.appendChild(document.createTextNode('.jpnlp-a+.jpnlp-a{margin-top:8px}.jpnlp-b{display:block;color:#565d61;font-weight:500;margin:0 0 4px}.jpnlp-c{color:#666;width:208px;height:26px;padding:0 5px;border:1px solid #cbced4;border-radius:3px;background-color:#fff}.jpnlp-c:hover{border-color:#b8bbbf;background-color:#f9fafb}.jpnlp-c:focus{border-color:#58b7df;background-color:#fff}')),document.head.appendChild(_d)}}var HIRAGANA='hiragana',KATAKANA='katakana',hiraganaMap={あ:'a',い:'i',う:'u',え:'e',お:'o',か:'ka',き:'ki',く:'ku',け:'ke',こ:'ko',さ:'sa',し:'shi',す:'su',せ:'se',そ:'so',た:'ta',ち:'chi',つ:'tsu',て:'te',と:'to',な:'na',に:'ni',ぬ:'nu',ね:'ne',の:'no',は:'ha',ひ:'hi',ふ:'fu',へ:'he',ほ:'ho',ま:'ma',み:'mi',む:'mu',め:'me',も:'mo',や:'ya',ゆ:'yu',よ:'yo',ら:'ra',り:'ri',る:'ru',れ:'re',ろ:'ro',わ:'wa',ゐ:'i',ゑ:'e',を:'o',ぁ:'a',ぃ:'i',ぅ:'u',ぇ:'e',ぉ:'o',が:'ga',ぎ:'gi',ぐ:'gu',げ:'ge',ご:'go',ざ:'za',じ:'ji',ず:'zu',ぜ:'ze',ぞ:'zo',だ:'da',ぢ:'ji',づ:'zu',で:'de',ど:'do',ば:'ba',び:'bi',ぶ:'bu',べ:'be',ぼ:'bo',ぱ:'pa',ぴ:'pi',ぷ:'pu',ぺ:'pe',ぽ:'po',きゃ:'kya',きゅ:'kyu',きょ:'kyo',しゃ:'sha',しゅ:'shu',しょ:'sho',ちゃ:'cha',ちゅ:'chu',ちょ:'cho',ちぇ:'che',にゃ:'nya',にゅ:'nyu',にょ:'nyo',ひゃ:'hya',ひゅ:'hyu',ひょ:'hyo',みゃ:'mya',みゅ:'myu',みょ:'myo',りゃ:'rya',りゅ:'ryu',りょ:'ryo',ぎゃ:'gya',ぎゅ:'gyu',ぎょ:'gyo',じゃ:'ja',じゅ:'ju',じょ:'jo',びゃ:'bya',びゅ:'byu',びょ:'byo',ぴゃ:'pya',ぴゅ:'pyu',ぴょ:'pyo'},katakanaMap={ア:'a',イ:'i',ウ:'u',エ:'e',オ:'o',カ:'ka',キ:'ki',ク:'ku',ケ:'ke',コ:'ko',サ:'sa',シ:'shi',ス:'su',セ:'se',ソ:'so',タ:'ta',チ:'chi',ツ:'tsu',テ:'te',ト:'to',ナ:'na',ニ:'ni',ヌ:'nu',ネ:'ne',ノ:'no',ハ:'ha',ヒ:'hi',フ:'fu',ヘ:'he',ホ:'ho',マ:'ma',ミ:'mi',ム:'mu',メ:'me',モ:'mo',ヤ:'ya',ユ:'yu',ヨ:'yo',ラ:'ra',リ:'ri',ル:'ru',レ:'re',ロ:'ro',ワ:'wa',ヲ:'o',ァ:'a',ィ:'i',ゥ:'u',ェ:'e',ォ:'o',ガ:'ga',ギ:'gi',グ:'gu',ゲ:'ge',ゴ:'go',ザ:'za',ジ:'ji',ズ:'zu',ゼ:'ze',ゾ:'zo',ダ:'da',ヂ:'ji',ヅ:'zu',デ:'de',ド:'do',バ:'ba',ビ:'bi',ブ:'bu',ベ:'be',ボ:'bo',パ:'pa',ピ:'pi',プ:'pu',ペ:'pe',ポ:'po',キャ:'kya',キュ:'kyu',キョ:'kyo',シャ:'sha',シュ:'shu',ショ:'sho',チャ:'cha',チュ:'chu',チョ:'cho',チェ:'che',ニャ:'nya',ニュ:'nyu',ニョ:'nyo',ヒャ:'hya',ヒュ:'hyu',ヒョ:'hyo',ミャ:'mya',ミュ:'myu',ミョ:'myo',リャ:'rya',リュ:'ryu',リョ:'ryo',ギャ:'gya',ギュ:'gyu',ギョ:'gyo',ジャ:'ja',ジュ:'ju',ジョ:'jo',ビャ:'bya',ビュ:'byu',ビョ:'byo',ピャ:'pya',ピュ:'pyu',ピョ:'pyo'};var Transliterator=function(){function Transliterator(){_classCallCheck(this,Transliterator),this.sokuon=['\u3063','\u30C3'],this.nn=['\u3093','\u30F3'],this.chSounds=['chi','cha','chu','cho'],this.consecutiveVowels={aa:!0,ee:!0,ii:!1,oo:!0,ou:!0,uu:!0}}return _createClass(Transliterator,[{key:'getRomaji',value:function getRomaji(a,b,d){var e='',f='';return b+1<a.length&&(f=a.substring(b,b+2),e=d[f]),!e&&b<a.length&&(f=a.substring(b,b+1),e=d[f]),{kana:f,romaji:e}}},{key:'convertToRomaji',value:function convertToRomaji(a){for(var l,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:HIRAGANA,d=b==HIRAGANA?hiraganaMap:katakanaMap,e=b==HIRAGANA?0:1,f='',g='',h='',j=0;j<a.length;){if(l=this.getRomaji(a,j,d),l.kana==this.sokuon[e]){var m=this.getRomaji(a,j+1,d);null!=m.romaji&&(-1<this.chSounds.indexOf(m.romaji)?l.romaji='t':l.romaji=m.romaji.substring(0,1))}else if(l.kana==this.nn[e]){var _m=this.getRomaji(a,j+1,d);l.romaji=_m.romaji&&-1!='bmp'.indexOf(_m.romaji.charAt(0))?'m':'n'}else b==KATAKANA&&'\u30FC'==l.kana&&(l.romaji='');if(null!=l.romaji){if(g){var k=g+l.romaji;2<k.length&&(k=k.substring(k.length-2)),this.consecutiveVowels[k]&&(l.romaji='')}f=f.concat(l.romaji)}else f=f.concat(l.kana);g=l.romaji,h=l.kana,j+=l.kana.length}return f}}]),Transliterator}();var FuriganaInputPresenter=function(){function FuriganaInputPresenter(){_classCallCheck(this,FuriganaInputPresenter),this.view=null,this.observer=null,this.kanjiInput=null,this.kanaInput=null,this.romajiInput=null,this.transliterator=null,this.isComposing=!1,this.transliterate=!0,this.lastHiragana='',this.kanjiCompositionStartHandler=this.createKanjiCompositionStartHandler(),this.kanjiCompositionEndHandler=this.createKanjiCompositionEndHandler(),this.kanjiCompositionUpdateHandler=this.createKanjiCompositionUpdateHandler(),this.kanjiKeyHandler=this.createKanjiKeyHandler(),this.kanaInputHandler=this.createKanaInputHandler(),this.romajiKeyHandler=this.createRomajiKeyHandler()}return _createClass(FuriganaInputPresenter,[{key:'createView',value:function createView(){return this.view=new FuriganaInputView,this.createMutationObserver(),injectStyles(),this.view}},{key:'setDataModel',value:function setDataModel(){}},{key:'onElementAdded',value:function onElementAdded(a,b){KANJI_INPUT_TYPE==a?(this.kanjiInput=b,this.kanjiInput.addEventListener('compositionstart',this.kanjiCompositionStartHandler),this.kanjiInput.addEventListener('compositionend',this.kanjiCompositionEndHandler),this.kanjiInput.addEventListener('compositionupdate',this.kanjiCompositionUpdateHandler),this.kanjiInput.addEventListener('keyup',this.kanjiKeyHandler)):KANA_INPUT_TYPE==a?(this.kanaInput=b,this.kanaInput.addEventListener('input',this.kanaInputHandler)):ROMAJI_INPUT_TYPE==a&&(this.romajiInput=b,this.romajiInput.addEventListener('keyup',this.romajiKeyHandler))}},{key:'onElementRemoved',value:function onElementRemoved(a,b){KANJI_INPUT_TYPE==a?(b.removeEventListener('compositionstart',this.kanjiCompositionStartHandler),b.removeEventListener('compositionend',this.kanjiCompositionEndHandler),b.removeEventListener('compositionupdate',this.kanjiCompositionUpdateHandler),b.removeEventListener('keyup',this.kanjiKeyHandler)):KANA_INPUT_TYPE==a?b.removeEventListener('input',this.kanaInputHandler):ROMAJI_INPUT_TYPE==a&&b.removeEventListener('keyup',this.romajiKeyHandler)}},{key:'createKanjiKeyHandler',value:function createKanjiKeyHandler(){var _this=this;return function(a){var b=a.keyCode;0===_this.kanjiInput.value.length&&(setFieldValue(_this.kanaInput,''),setFieldValue(_this.romajiInput,''),_this.isComposing=!1,_this.lastHiragana='',_this.transliterate=!0),!_this.isComposing&&SPACE_KEY_CODE===b&&_this.kanaInput&&(setFieldValue(_this.kanaInput,_this.kanaInput.value.concat(WIDE_SPACE)),dispatchEvent(_this.kanaInput,'change'),dispatchEvent(_this.kanaInput,'input'))}}},{key:'getTransliteratorInstance',value:function getTransliteratorInstance(){return this.transliterator||(this.transliterator=new Transliterator),this.transliterator}},{key:'createKanjiCompositionStartHandler',value:function createKanjiCompositionStartHandler(){var _this2=this;return function(){_this2.isComposing=!0}}},{key:'createKanjiCompositionEndHandler',value:function createKanjiCompositionEndHandler(){var _this3=this;return function(){if(_this3.kanaInput&&0<_this3.lastHiragana.length){var b=hiraganaArrayToKatakanaArray(_this3.lastHiragana.split('')).join('');setFieldValue(_this3.kanaInput,_this3.kanaInput.value+b),dispatchEvent(_this3.kanaInput,'change'),dispatchEvent(_this3.kanaInput,'input')}_this3.lastHiragana='',_this3.isComposing=!1}}},{key:'createKanjiCompositionUpdateHandler',value:function createKanjiCompositionUpdateHandler(){var _this4=this;return function(a){if(0===a.data.length)_this4.lastHiragana='';else{var b=a.data.match(HIRAGANA_INPUT_REGEX);b&&(_this4.lastHiragana=b.join(''))}}}},{key:'createKanaInputHandler',value:function createKanaInputHandler(){var _this5=this;return function(){if(_this5.romajiInput&&_this5.transliterate){var b=_this5.kanaInput.value;0<b.length&&INVALID_KANA_INPUT_REGEX.test(b)&&(b=filterWithRegex(b,VALID_KANA_INPUT_REGEX));var d=_this5.getTransliteratorInstance().convertToRomaji(b,KATAKANA);setFieldValue(_this5.romajiInput,d.charAt(0).toUpperCase()+d.slice(1)),dispatchEvent(_this5.romajiInput,'change')}}}},{key:'createRomajiKeyHandler',value:function createRomajiKeyHandler(){var _this6=this;return function(){_this6.transliterate=!1}}},{key:'createMutationObserver',value:function createMutationObserver(){var _this7=this;this.destroyMutationObserver(),this.observer=new MutationObserver(function(a){for(var b=0;b<a.length;++b){var d=a[b].addedNodes,e=a[b].removedNodes;if(0<e.length)for(var g,f=0;f<e.length;++f){if(g=e[f],Node.ELEMENT_NODE!=g.nodeType)return;var h=g,j=h.getAttribute(FURIGANA_INPUT_ATTRIBUTE_KEY);j&&_this7.onElementRemoved(j,h.childNodes[1])}if(0<d.length)for(var _g,_f=0;_f<d.length;++_f){if(_g=d[_f],Node.ELEMENT_NODE!=_g.nodeType)return;var _h=_g,_j=_h.getAttribute(FURIGANA_INPUT_ATTRIBUTE_KEY);_j&&_this7.onElementAdded(_j,_g.childNodes[1])}}}),this.view&&this.observer.observe(this.view.containerElement,{childList:!0})}},{key:'destroyMutationObserver',value:function destroyMutationObserver(){this.observer&&this.observer.disconnect(),this.observer=null}}]),FuriganaInputPresenter}();function dispatchEvent(a,b){if(a){var d=document.createEvent('HTMLEvents');d.initEvent(b,!0,!0),a.dispatchEvent(d)}}function setFieldValue(a,b){a&&(a.value=b)}function hiraganaArrayToKatakanaArray(a){return a.map(function(b){return'\u3090'===b?'\u30A4':'\u3091'===b?'\u30A8':String.fromCharCode(b.charCodeAt(0)+HIRAGANA_KATAKANA_OFFSET)})}function filterWithRegex(a,b){var d=a.match(b);return d?d.join(''):''}var FuriganaInputView=function(){function FuriganaInputView(){_classCallCheck(this,FuriganaInputView),this.rootElement=document.createElement('div'),this.containerElement=this.rootElement}return _createClass(FuriganaInputView,[{key:'render',value:function render(a,b){return new Uint32Array([220,b])}}]),FuriganaInputView}();var SubPresenter=function(){function SubPresenter(){_classCallCheck(this,SubPresenter),this.view=null}return _createClass(SubPresenter,[{key:'createView',value:function createView(){var _this8=this;return this.view=new SubInputView(this.inputType),this.view.addValueChangeHandler(function(){_this8.view&&workday.flow.updateValue(_this8,_this8.view.getValue())}),this.view}},{key:'setDataModel',value:function setDataModel(){}},{key:'setValueModel',value:function setValueModel(a){this.view&&this.view.setValue(a)}},{key:'setLabel',value:function setLabel(a){this.view&&this.view.setLabel(a)}}]),SubPresenter}();var KanjiInputPresenter=function(_SubPresenter){function KanjiInputPresenter(){_classCallCheck(this,KanjiInputPresenter);var _this9=_possibleConstructorReturn(this,(KanjiInputPresenter.__proto__||Object.getPrototypeOf(KanjiInputPresenter)).apply(this,arguments));return _this9.inputType=KANJI_INPUT_TYPE,_this9.inputType=KANJI_INPUT_TYPE,_this9}return _inherits(KanjiInputPresenter,_SubPresenter),KanjiInputPresenter}(SubPresenter);var KanaInputPresenter=function(_SubPresenter2){function KanaInputPresenter(){_classCallCheck(this,KanaInputPresenter);var _this10=_possibleConstructorReturn(this,(KanaInputPresenter.__proto__||Object.getPrototypeOf(KanaInputPresenter)).apply(this,arguments));return _this10.inputType=KANA_INPUT_TYPE,_this10.inputType=KANA_INPUT_TYPE,_this10}return _inherits(KanaInputPresenter,_SubPresenter2),KanaInputPresenter}(SubPresenter);var RomajiInputPresenter=function(_SubPresenter3){function RomajiInputPresenter(){_classCallCheck(this,RomajiInputPresenter);var _this11=_possibleConstructorReturn(this,(RomajiInputPresenter.__proto__||Object.getPrototypeOf(RomajiInputPresenter)).apply(this,arguments));return _this11.inputType=ROMAJI_INPUT_TYPE,_this11.inputType=ROMAJI_INPUT_TYPE,_this11}return _inherits(RomajiInputPresenter,_SubPresenter3),RomajiInputPresenter}(SubPresenter);var SubInputView=function(){function SubInputView(a){_classCallCheck(this,SubInputView),this.rootElement=document.createElement('div'),this.rootElement.setAttribute(FURIGANA_INPUT_ATTRIBUTE_KEY,a),this.rootElement.className=style('field_pair'),this.labelElement=document.createElement('label'),this.labelElement.className=style('label'),this.inputElement=document.createElement('input'),this.inputElement.className=style('input'),this.inputElement.setAttribute('type','text'),this.rootElement.appendChild(this.labelElement),this.rootElement.appendChild(this.inputElement)}return _createClass(SubInputView,[{key:'render',value:function render(a,b){return new Uint32Array([a,b])}},{key:'setLabel',value:function setLabel(a){this.labelElement.innerHTML=a}},{key:'getValue',value:function getValue(){return this.inputElement.value}},{key:'setValue',value:function setValue(a){this.inputElement.value=a}},{key:'addValueChangeHandler',value:function addValueChangeHandler(a){this.inputElement.addEventListener('change',a)}}]),SubInputView}();var FuriganaInputPresenterFactory=function(){function FuriganaInputPresenterFactory(){_classCallCheck(this,FuriganaInputPresenterFactory)}return _createClass(FuriganaInputPresenterFactory,[{key:'createPresenter',value:function createPresenter(){return new FuriganaInputPresenter}}]),FuriganaInputPresenterFactory}();var KanjiInputPresenterFactory=function(){function KanjiInputPresenterFactory(){_classCallCheck(this,KanjiInputPresenterFactory)}return _createClass(KanjiInputPresenterFactory,[{key:'createPresenter',value:function createPresenter(){return new KanjiInputPresenter}}]),KanjiInputPresenterFactory}();var KanaInputPresenterFactory=function(){function KanaInputPresenterFactory(){_classCallCheck(this,KanaInputPresenterFactory)}return _createClass(KanaInputPresenterFactory,[{key:'createPresenter',value:function createPresenter(){return new KanaInputPresenter}}]),KanaInputPresenterFactory}();var RomajiInputPresenterFactory=function(){function RomajiInputPresenterFactory(){_classCallCheck(this,RomajiInputPresenterFactory)}return _createClass(RomajiInputPresenterFactory,[{key:'createPresenter',value:function createPresenter(){return new RomajiInputPresenter}}]),RomajiInputPresenterFactory}();var widgetRegistrar=function(){workday.widget.register('furigana',new FuriganaInputPresenterFactory),workday.widget.register('kanjiInput',new KanjiInputPresenterFactory),workday.widget.register('kanaInput',new KanaInputPresenterFactory),workday.widget.register('romajiInput',new RomajiInputPresenterFactory),document.body.removeEventListener('workday:onload',widgetRegistrar)};workday.loaded?widgetRegistrar():document.body.addEventListener('workday:onload',widgetRegistrar);